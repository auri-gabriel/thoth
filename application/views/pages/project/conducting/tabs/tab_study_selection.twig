<div class="container-fluid py-4">
	<div class="row justify-content-center">
		<div class="card shadow-sm h-100">
			<div class="card-body">
				<div class="d-flex align-items-center mb-2">
					<label for="id_qa" class="mb-0"><strong>Study Selection</strong></label>
					<a onclick="modal_help('modal_help_selection')" class="ms-auto opt" tabindex="0" aria-label="Help about study selection" data-bs-toggle="tooltip" title="How to select studies?"><i class="fas fa-question-circle"></i></a>
				</div>
				{% if data.project.get_planning == 100 and data.project.get_import == 100 %}
					{% set acc = ((data.count_papers[1] * 100) / data.count_papers[6])|number_format(2) %}
					{% set rej = ((data.count_papers[2] * 100) / data.count_papers[6])|number_format(2) %}
					{% set unc = ((data.count_papers[3] * 100) / data.count_papers[6])|number_format(2) %}
					{% set dup = ((data.count_papers[4] * 100) / data.count_papers[6])|number_format(2) %}
					{% set rem = ((data.count_papers[5] * 100) / data.count_papers[6])|number_format(2) %}
					<!-- Generic Progress Indicator Bar and Labels -->
					<div class="progress-indicator-container mb-4">
						<div class="d-flex align-items-center justify-content-between flex-wrap mb-2">
							<h6 class="mb-0 fw-bold">Progress Study Selection</h6>
							<div class="d-flex gap-2 flex-wrap">
								<span class="badge rounded-pill progress-indicator-badge-acc"><i class="fas fa-check me-1"></i>Accepted: <span id="count_acc">{{ data.count_papers[1] }}</span></span>
								<span class="badge rounded-pill progress-indicator-badge-rej"><i class="fas fa-times me-1"></i>Rejected: <span id="count_rej">{{ data.count_papers[2] }}</span></span>
								<span class="badge rounded-pill progress-indicator-badge-unc"><i class="fas fa-question me-1"></i>Unclassified: <span id="count_unc">{{ data.count_papers[3] }}</span></span>
								<span class="badge rounded-pill progress-indicator-badge-dup"><i class="fas fa-copy me-1"></i>Duplicate: <span id="count_dup">{{ data.count_papers[4] }}</span></span>
								<span class="badge rounded-pill progress-indicator-badge-rem"><i class="fas fa-trash-alt me-1"></i>Removed: <span id="count_rem">{{ data.count_papers[5] }}</span></span>
								<span class="badge rounded-pill progress-indicator-badge-total"><i class="fas fa-bars me-1"></i>Total: <span id="count_total">{{ data.count_papers[6] }}</span></span>
							</div>
						</div>
						<div class="progress progress-indicator-bar" style="height: 1.5rem;">
							<div id="prog_acc" class="progress-bar progress-indicator-bar-acc" role="progressbar"
								style="width: {{ acc }}%"
								aria-valuenow="{{ acc }}"
								aria-valuemin="0"
								aria-valuemax="100">
								{{ acc }}%
							</div>
							<div id="prog_rej" class="progress-bar progress-indicator-bar-rej" role="progressbar"
								style="width: {{ rej }}%"
								aria-valuenow="{{ rej }}"
								aria-valuemin="0"
								aria-valuemax="100">
								{{ rej }}%
							</div>
							<div id="prog_unc" class="progress-bar progress-indicator-bar-unc" role="progressbar"
								style="width: {{ unc }}%"
								aria-valuenow="{{ unc }}"
								aria-valuemin="0"
								aria-valuemax="100">
								{{ unc }}%
							</div>
							<div id="prog_dup" class="progress-bar progress-indicator-bar-dup" role="progressbar"
								style="width: {{ dup }}%"
								aria-valuenow="{{ dup }}"
								aria-valuemin="0"
								aria-valuemax="100">
								{{ dup }}%
							</div>
							<div id="prog_rem" class="progress-bar progress-indicator-bar-rem" role="progressbar"
								style="width: {{ rem }}%"
								aria-valuenow="{{ rem }}"
								aria-valuemin="0"
								aria-valuemax="100">
								{{ rem }}%
							</div>
						</div>
					</div>
					<div class="table-responsive mt-4">
						<table class="table table-bordered table-hover align-middle" id="table_papers">
							<caption class="visually-hidden">List of Papers Imported</caption>
							<thead class="table-light">
								<tr>
									<th>ID</th>
									<th>Title</th>
									{% for ic in data.project.get_inclusion_criteria %}
										<th>{{ ic.get_id }}</th>
									{% endfor %}
									{% for ec in data.project.get_exclusion_criteria %}
										<th>{{ ec.get_id }}</th>
									{% endfor %}
									<th>Database</th>
									<th>Status</th>
								</tr>
							</thead>
							<tbody>
								{% for paper in data.project.get_papers %}
									<tr>
										<td>{{ paper.get_id }}</td>
										<td>{{ paper.get_title }}</td>
										{% set cs = data.criterias[paper.get_id] %}
										{% for ic in data.project.get_inclusion_criteria %}
											<td>
												{% if cs[ic.get_id] == 'True' %}
													<i class="fas fa-check text-success"></i> True
												{% else %}
													<i class="fas fa-times text-danger"></i> False
												{% endif %}
											</td>
										{% endfor %}
										{% for ec in data.project.get_exclusion_criteria %}
											<td>
												{% if cs[ec.get_id] == 'True' %}
													<i class="fas fa-check text-success"></i> True
												{% else %}
													<i class="fas fa-times text-danger"></i> False
												{% endif %}
											</td>
										{% endfor %}
										<td>{{ paper.get_database }}</td>
										{% set class = 'text-dark' %}
										{% set status = 'Unclassified' %}
										{% if paper.get_status_selection == 1 %}
											{% set class = 'text-success' %}
											{% set status = 'Accepted' %}
										{% elseif paper.get_status_selection == 2 %}
											{% set class = 'text-danger' %}
											{% set status = 'Rejected' %}
										{% elseif paper.get_status_selection == 4 %}
											{% set class = 'text-warning' %}
											{% set status = 'Duplicate' %}
										{% elseif paper.get_status_selection == 5 %}
											{% set class = 'text-info' %}
											{% set status = 'Removed' %}
										{% endif %}
										<td id="{{ paper.get_id }}" class="font-weight-bold {{ class }}">{{ status }}</td>
									</tr>
								{% endfor %}
							</tbody>
							<tfoot class="table-light">
								<tr>
									<th>ID</th>
									<th>Title</th>
									{% for ic in data.project.get_inclusion_criteria %}
										<th>{{ ic.get_id }}</th>
									{% endfor %}
									{% for ec in data.project.get_exclusion_criteria %}
										<th>{{ ec.get_id }}</th>
									{% endfor %}
									<th>Database</th>
									<th>Status</th>
								</tr>
							</tfoot>
						</table>
					</div>
				{% else %}
					<div class="alert alert-warning container-fluid alert-dismissible fade show mt-4" role="alert">
						<h5>Complete these tasks to advance</h5>
						<ul>
							{% for error in data.project.get_errors %}
								<li>{{ error }}</li>
							{% endfor %}
						</ul>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
	<div class="d-flex justify-content-between align-items-center mt-4 mb-5">
		<a href="#tab_import_studies" class="btn btn-outline-secondary" data-bs-toggle="tooltip" title="Go to previous step"><span class="fas fa-backward"></span> Previous</a>
		<a href="#tab_quality_assessment" class="btn btn-primary opt" data-bs-toggle="tooltip" title="Go to next step">Next <span class="fas fa-forward"></span></a>
	</div>
</div>
{% include 'modal/modal_paper_selection.php' %}
<script src="{{ base_url('assets/js/study_selection.js') }}"></script>
